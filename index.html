<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="WBC 2026">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3516/3516315.png">
    <title>WBC æ‡‰æ´ä¹‹æ—… 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@700&family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #fcfaf2; color: #4a4a4a; -webkit-tap-highlight-color: transparent; }
        h2, .font-serif { font-family: 'Noto Serif TC', serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .date-item { opacity: 0.3; transition: all 0.3s ease; }
        .active-date { opacity: 1 !important; transform: translateY(-2px); }
        .active-date .date-num { color: #0035ad !important; font-weight: 800; } /* æ‡‰æ´è— */
        .date-dot { width: 4px; height: 4px; border-radius: 50%; background-color: transparent; margin: 4px auto 0; }
        .active-date .date-dot { background-color: #e4002b; } /* æ‡‰æ´ç´… */
        .timeline-wrapper { position: relative; width: 100%; }
        .timeline-line { position: absolute; left: 19px; top: 10px; bottom: 20px; width: 2px; background-color: #e2e8f0; z-index: 0; }
        .timeline-dot { z-index: 10; background-color: #fff; border: 2px solid #0035ad; width: 12px; height: 12px; border-radius: 50%; position: absolute; left: 14px; top: 8px; }
        .sub-card { background-color: #ffffff; border-left: 4px solid #0035ad; margin-left: 1rem; margin-top: 0.5rem; padding: 0.7rem; border-radius: 0.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.03); cursor: pointer; }
        .nav-btn-active { color: #0035ad !important; }
        #map-container { height: 260px; width: 100%; border-radius: 1.5rem; margin-top: 1.5rem; border: 4px solid #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.08); z-index: 10; }
        .ledger-row { display: grid; grid-template-columns: 5.5rem 1fr; align-items: center; background: #fff; border: 1px solid #f3f4f6; border-radius: 1rem; padding: 0.6rem 0.8rem; margin-bottom: 0.5rem; gap: 0.5rem; }
        .ledger-row-label { font-size: 0.7rem; font-weight: 800; border-radius: 0.4rem; padding: 0.2rem 0; width: 100%; text-align: center; }
        .row-blue { background-color: #e0e7ff; color: #4338ca; }
        .row-gray { background-color: #f3f4f6; color: #6b7280; }
        .ledger-row-input { width: 100%; border: none; font-size: 1rem; font-weight: 600; outline: none; background: transparent; text-align: center; }
        .wbc-tag { background-color: #e4002b; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden">
    <header id="app-header" class="bg-[#fcfaf2] pt-4 pb-2 px-5 sticky top-0 z-30 shadow-sm border-b border-blue-50 flex-shrink-0 text-center">
        <div class="text-center mb-1">
            <h1 class="text-[7px] tracking-[0.2em] text-gray-400 font-bold uppercase">2026 World Baseball Classic</h1>
            <h2 class="text-lg font-bold text-gray-800">WBC æ‡‰æ´ä¹‹æ—… <span class="text-[10px] font-normal text-white bg-blue-600 px-1.5 py-0.5 rounded-full ml-1">Tokyo</span></h2>
        </div>
        
        <div class="flex justify-center gap-3 mb-3" id="weather-info">
            <div class="flex items-center gap-1.5 bg-white/70 px-3 py-1 rounded-full border border-gray-100 shadow-sm">
                <span class="text-[8px] font-bold text-gray-500 uppercase">Today</span>
                <i id="w-icon-0" class="fas fa-sun text-orange-400 text-xs"></i>
                <span id="w-temp-0" class="text-xs font-mono font-bold text-gray-600">--Â°</span>
            </div>
            <div class="flex items-center gap-1.5 bg-white/70 px-3 py-1 rounded-full border border-gray-100 shadow-sm">
                <span class="text-[8px] font-bold text-gray-500 uppercase">Tomorrow</span>
                <i id="w-icon-1" class="fas fa-cloud text-blue-400 text-xs"></i>
                <span id="w-temp-1" class="text-xs font-mono font-bold text-gray-600">--Â°</span>
            </div>
        </div>

        <div class="grid grid-cols-3 items-end min-h-[50px]">
            <div class="col-start-1"></div>
            <div id="date-picker-container" class="flex space-x-5 justify-center items-end pb-1 overflow-x-auto no-scrollbar"></div>
            <div class="flex justify-end space-x-3 pb-0.5">
                <button onclick="toggleView('checklist')" id="checklist-toggle" class="flex flex-col items-center text-gray-300">
                    <i class="fas fa-toolbox text-lg mb-0.5"></i>
                    <span class="text-[9px] font-bold">åŠ©æ‰‹</span>
                </button>
                <button onclick="toggleView('ledger')" id="ledger-toggle" class="flex flex-col items-center text-gray-300">
                    <i class="fas fa-wallet text-lg mb-0.5"></i>
                    <span class="text-[9px] font-bold">å¸³æœ¬</span>
                </button>
            </div>
        </div>
    </header>

    <main id="content" class="flex-1 overflow-y-auto p-5 pb-24 bg-[#fcfaf2]"></main>

    <div id="detail-modal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden flex items-end sm:items-center justify-center transition-opacity duration-300 opacity-0">
        <div class="bg-white w-full sm:max-w-md sm:rounded-2xl rounded-t-3xl overflow-hidden max-h-[85vh] flex flex-col transform translate-y-full transition-transform duration-300 ease-out">
            <div class="relative h-56 flex-shrink-0">
                <img id="modal-img" src="" class="w-full h-full object-cover">
                <button onclick="closeModal()" class="absolute top-4 right-4 bg-black bg-opacity-40 text-white rounded-full p-2 backdrop-blur-sm"><i class="fas fa-xmark"></i></button>
            </div>
            <div class="p-6 overflow-y-auto">
                <span id="modal-tag" class="text-[10px] font-bold tracking-widest uppercase bg-blue-700 px-2 py-1 rounded text-white mb-2 inline-block"></span>
                <h3 id="modal-title" class="text-2xl font-bold text-gray-900 mb-2 leading-tight"></h3>
                <div id="modal-hours-box" class="text-xs text-gray-500 mb-4 pb-3 border-b border-gray-100 flex items-center"><i class="far fa-clock mr-2 text-blue-400"></i><span id="modal-hours-text"></span></div>
                <p id="modal-desc" class="text-gray-600 leading-relaxed text-sm mb-6 whitespace-pre-line"></p>
                
                <div id="modal-transport-container" class="hidden mb-6 bg-blue-50 p-4 rounded-xl border border-blue-100">
                    <h4 class="text-[10px] font-bold text-blue-600 uppercase mb-1"><i class="fas fa-train mr-1"></i> äº¤é€š/è½‰ä¹˜é‡é»</h4>
                    <p id="modal-transport" class="text-xs text-blue-800 leading-relaxed"></p>
                </div>

                <a id="modal-google-link" href="#" target="_blank" class="w-full bg-gray-900 text-white py-4 rounded-xl flex items-center justify-center font-bold text-sm shadow-md"><i class="fab fa-google mr-2 text-blue-400"></i> Google Maps å°èˆª</a>
            </div>
        </div>
    </div>

    <script>
        // --- æ ¸å¿ƒè³‡æ–™ ---
        const startDate = new Date('2026-03-04T07:35:00');
        const daysOfWeek = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
        let currentDay = 1;
        let activeTab = 'itinerary';
        let map = null;

        const tripData = {
            1: [
                { time: "07:35", tag: "Flight", title: "CI154 é£›å¾€åå¤å±‹", icon: "fa-plane", map: "æ¡ƒåœ’åœ‹éš›æ©Ÿå ´", desc: "é–‹å•Ÿ 2026 WBC æ‡‰æ´ä¹‹æ—…ï¼å‰å¾€æ¡ƒåœ’æ©Ÿå ´ç¬¬äºŒèˆªå»ˆæ­æ©Ÿã€‚", img: "https://images.unsplash.com/photo-1436491865332-7a61a109cc05?q=80&w=1000", lat: 25.079, lng: 121.234 },
                { time: "11:45", tag: "Transit", title: "æ­ä¹˜ Î¼-sky å‰å¾€å¸‚å€", icon: "fa-train", map: "ä¸­éƒ¨åœ‹éš›æ©Ÿå ´", transport: "Î¼-sky ç‰¹æ€¥åˆ—è»Šï¼Œå…¨è»ŠæŒ‡å®šå¸­ã€‚ç´„28åˆ†é˜æŠµé”åå¤å±‹ç«™ã€‚", desc: "æŠµé”åå¤å±‹ä¸­éƒ¨æ©Ÿå ´å¾Œï¼Œé †è‘—æŒ‡æ¨™å‰å¾€åéµè»Šç«™è³¼è²· Î¼-sky ç¥¨åˆ¸ã€‚", img: "https://upload.wikimedia.org/wikipedia/commons/2/29/Meitetsu_2000_series_U-SKY.jpg", lat: 34.858, lng: 136.816 },
                { time: "15:00", tag: "Shinkansen", title: "æ–°å¹¹ç·šå‰å¾€æ±äº¬", icon: "fa-bolt", map: "åå¤å±‹ç«™", transport: "å‹™å¿…é ç´„ã€Œç‰¹å¤§è·ç‰©åº§å¸­ã€ (å¤§å‹è¡Œæä½)ã€‚", desc: "æ­ä¹˜æ–°å¹¹ç·šã€å¸Œæœ›è™Ÿ (Nozomi)ã€ï¼Œç´„ 1 å°æ™‚ 40 åˆ†æŠµé”æ±äº¬è»Šç«™ã€‚", img: "https://images.unsplash.com/photo-1542365887-11499f1ddee5?q=80&w=1000", lat: 35.170, lng: 136.881 },
                { time: "17:00", tag: "Hotel", title: "APA Hotel æ–°å¾¡å¾’ç”º Check-in", icon: "fa-hotel", map: "APA Hotel Shin Okachimachi Ekimae", desc: "æ±äº¬æœŸé–“çš„åŸºåœ°ã€‚è·é›¢å¤§æ±Ÿæˆ¶ç·šèˆ‡ç­‘æ³¢å¿«ç·šæ–°å¾¡å¾’ç”ºç«™æ¥µè¿‘ã€‚", img: "https://www.apahotel.com/view_img.php?id=32402", lat: 35.706, lng: 139.780 },
                { time: "18:00", tag: "Shopping", title: "é˜¿ç¾æ©«ç”º & ç§‹è‘‰åŸ", icon: "fa-bag-shopping", map: "é˜¿ç¾æ©«ç”º", desc: "æ™šé¤èˆ‡ç‰©è³‡è£œçµ¦ã€‚é †ä¾¿å»ç§‹è‘‰åŸå·¡ç¦®ï¼Œæ„Ÿå—å‹•æ¼«è–åœ°æ°›åœã€‚", img: "https://images.unsplash.com/photo-1555529733-0e670560f7e1?q=80&w=1000", lat: 35.710, lng: 139.774 }
            ],
            2: [
                { time: "08:30", tag: "Sightseeing", title: "æ·ºè‰å¯ºåƒæ‹œ", icon: "fa-torii-gate", map: "æ·ºè‰å¯º", desc: "æ—©ä¸Šäººæ½®è¼ƒå°‘æ™‚å‰å¾€ã€‚é›·é–€å¤§ç‡ˆç± æ‹ç…§ã€ä»²è¦‹ä¸–é€šé€›é€›ã€‚", img: "https://images.unsplash.com/photo-1545569341-9eb8b30979d9?q=80&w=1000", lat: 35.714, lng: 139.796 },
                { time: "12:00", tag: "WBC", title: "âš¾ å°ç£ vs æ¾³æ´²", icon: "fa-baseball-bat-ball", map: "æ±äº¬å·¨è›‹", desc: "ã€WBC é¦–æˆ°ã€‘åœ°é»ï¼šæ±äº¬å·¨è›‹ã€‚å°ç£è‹±é›„åŠ æ²¹ï¼", img: "https://images.unsplash.com/photo-1516731415730-0c607149933a?q=80&w=1000", lat: 35.705, lng: 139.751 },
                { time: "16:00", tag: "Shopping", title: "Mizuno ç¥ä¿ç”ºæ——è‰¦åº—", icon: "fa-store", map: "Mizuno Tokyo", desc: "é‹å‹•è£å‚™è–åœ°ã€‚å¯ä»¥æ‰¾æ‰¾ WBC æ‡‰æ´å•†å“æˆ–å°ˆæ¥­è·‘é‹/è¥ªå­ã€‚", img: "https://corp.mizuno.com/sites/corp/files/styles/og_image/public/2021-12/shop_tokyo_0.jpg", lat: 35.695, lng: 139.762 },
                { time: "18:00", tag: "Dinner", title: "æ–°å®¿é€›è¡—èˆ‡æ™šé¤", icon: "fa-utensils", map: "æ–°å®¿è»Šç«™", desc: "æ„Ÿå—ä¸–ç•Œæœ€ç¹å¿™è»Šç«™çš„é­…åŠ›ï¼Œå°‹æ‰¾ç¾å‘³æ™šé¤ã€‚", img: "https://images.unsplash.com/photo-1503899036084-c55cdd92da26?q=80&w=1000", lat: 35.689, lng: 139.700 }
            ],
            3: [
                { time: "08:30", tag: "Tour", title: "éŒå€‰ã€æ±Ÿä¹‹å³¶ä¸€æ—¥éŠ", icon: "fa-umbrella-beach", map: "éŒå€‰é«˜æ ¡å‰", transport: "æ­ä¹˜ JR æ¹˜å—æ–°å®¿ç·šè‡³å¤§èˆ¹/è—¤æ¾¤ï¼Œè½‰æ­æ±Ÿä¹‹é›»ã€‚", desc: "ã€æ¨è–¦å‹•ç·šã€‘\n1. éŒå€‰ç«™ (å°ç”ºé€š & å…«å¹¡å®®)\n2. é•·è°·ç«™ (éŒå€‰å¤§ä½›)\n3. éŒå€‰é«˜æ ¡å‰ (ç¶“å…¸å¹³äº¤é“)\n4. æ±Ÿä¹‹å³¶ (ç¥ç¤¾ & å±•æœ›å¡”)", img: "https://images.unsplash.com/photo-1560264280-88b68371db39?q=80&w=1000", lat: 35.306, lng: 139.486 },
                { time: "19:00", tag: "WBC", title: "ğŸ“º è½‰æ’­ï¼šå°ç£ vs æ—¥æœ¬", icon: "fa-tv", map: "HUB Akihabara", desc: "åœ°é»å¾…å®šã€‚æ¨è–¦å»ä¸Šé‡æˆ–ç§‹è‘‰åŸçš„é‹å‹•é…’å§ (HUB) èˆ‡çƒè¿·åŒæ¨‚ï¼", img: "https://images.unsplash.com/photo-1543007630-9710e4a00a20?q=80&w=1000", lat: 35.698, lng: 139.771 }
            ],
            4: [
                { time: "09:00", tag: "Sightseeing", title: "æ—¥æç¥ç¤¾åƒæ‹œ", icon: "fa-vihara", map: "æ—¥æç¥ç¤¾", desc: "æ¬£è³è‘—åçš„å±±ç‹é³¥å±…ï¼Œç‚ºä»Šæ—¥è³½äº‹ç¥ˆæ±‚å¥½é‹ã€‚", img: "https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?q=80&w=1000", lat: 35.674, lng: 139.739 },
                { time: "12:00", tag: "WBC", title: "âš¾ å°ç£ vs æ·å…‹", icon: "fa-baseball-bat-ball", map: "æ±äº¬å·¨è›‹", desc: "å†æ¬¡é€²å…¥å·¨è›‹æ‡‰æ´ï¼", img: "https://images.unsplash.com/photo-1508344928928-7165b67de128?q=80&w=1000", lat: 35.705, lng: 139.751 },
                { time: "17:00", tag: "Shopping", title: "åŸå®¿ & æ¾€è°·", icon: "fa-masks-theater", map: "Shibuya Crossing", desc: "æœè–æ¾€è°·åå­—è·¯å£ï¼ŒåŸå®¿é€›æ½®æµåº—ã€‚", img: "https://images.unsplash.com/photo-1542051841857-5f90071e7989?q=80&w=1000", lat: 35.659, lng: 139.700 }
            ],
            5: [
                { time: "12:00", tag: "WBC", title: "âš¾ å°ç£ vs éŸ“åœ‹", icon: "fa-fire", map: "æ±äº¬å·¨è›‹", desc: "ã€ç†±è¡€å¤§æˆ°ã€‘ç¶“å…¸å°éŸ“å°æ±ºï¼æ‡‰æ´è²ä¸èƒ½è¼¸ï¼", img: "https://images.unsplash.com/photo-1516731415730-0c607149933a?q=80&w=1000", lat: 35.705, lng: 139.751 },
                { time: "18:30", tag: "Shinkansen", title: "æ–°å¹¹ç·šå›åå¤å±‹", icon: "fa-train-subway", map: "æ±äº¬ç«™", transport: "è¡Œæå‹™å¿…é ç´„ç‰¹å¤§è·ç‰©åº§å¸­ã€‚", desc: "çµæŸæ±äº¬è¡Œç¨‹ï¼Œè¿”å›åå¤å±‹ã€‚", img: "https://images.unsplash.com/photo-1542365887-11499f1ddee5?q=80&w=1000", lat: 35.681, lng: 139.767 },
                { time: "21:00", tag: "Hotel", title: "APA åå¤å±‹ç«™å‰åŒ—", icon: "fa-hotel", map: "APA Hotel Nagoya Ekimae Kita", desc: "åå¤å±‹çš„è½è…³è™•ï¼Œåœ°ç†ä½ç½®å„ªè¶Šã€‚", img: "https://www.apahotel.com/view_img.php?id=314", lat: 35.174, lng: 136.884 }
            ],
            6: [
                { time: "09:30", tag: "Sightseeing", title: "åå¤å±‹åŸå·¡ç¦®", icon: "fa-chess-rook", map: "åå¤å±‹åŸ", desc: "çœ‹å£¯è§€çš„é‡‘é¯±èˆ‡æœ¬ä¸¸å¾¡æ®¿ã€‚", img: "https://images.unsplash.com/photo-1590559899731-a3828df9a954?q=80&w=1000", lat: 35.184, lng: 136.901 },
                { time: "12:00", tag: "Market", title: "å¤§é ˆè§€éŸ³èˆ‡å•†åº—è¡—", icon: "fa-store", map: "å¤§é ˆè§€éŸ³", desc: "è¶…å¥½é€›çš„å¹³æ°‘å•†åº—è¡—ï¼Œæœ‰å¾ˆå¤šç‰¹è‰²å°åƒã€‚", img: "https://upload.wikimedia.org/wikipedia/commons/0/0e/Osu_Kannon_Nagoya_01.JPG", lat: 35.159, lng: 136.899 },
                { time: "16:00", tag: "Night", title: "æ¦®å•†åœˆ & ç¶ æ´² 21", icon: "fa-tower-observation", map: "Oasis 21", desc: "ç™»ä¸Šé›»è¦–å¡”æˆ–ç¶ æ´² 21 çœ‹å¤œæ™¯ã€‚", img: "https://images.unsplash.com/photo-1610459341400-349071c356f9?q=80&w=1000", lat: 35.171, lng: 136.909 }
            ],
            7: [
                { time: "07:30", tag: "Transit", title: "Î¼-sky å‰å¾€ä¸­éƒ¨æ©Ÿå ´", icon: "fa-train", map: "åå¤å±‹ç«™", desc: "ææ—©å‰å¾€æ©Ÿå ´é€²è¡Œæœ€å¾Œæ¡è²· (æ©Ÿå ´è¦é¤…ï¼)ã€‚", img: "https://upload.wikimedia.org/wikipedia/commons/2/29/Meitetsu_2000_series_U-SKY.jpg", lat: 34.858, lng: 136.816 },
                { time: "09:50", tag: "Flight", title: "CI151 é£›å¾€æ¡ƒåœ’", icon: "fa-plane-arrival", map: "ä¸­éƒ¨åœ‹éš›æ©Ÿå ´", desc: "çµæŸé€™è¶Ÿç†±è¡€æ‡‰æ´ä¹‹æ—…ã€‚ä¸‹æ¬¡å†æˆ°ï¼", img: "https://images.unsplash.com/photo-1436491865332-7a61a109cc05?q=80&w=1000", lat: 25.079, lng: 121.234 }
            ]
        };

        const packingList = [
            { cat: "WBC æ‡‰æ´ç‰©", items: ["å°ç£éšŠçƒè¡£", "åŠ æ²¹æ£’", "æ‡‰æ´æ¯›å·¾", "å–‰ç³– (å–Šç´¯å¿…å‚™)"] },
            { cat: "æ—…éŠè­‰ä»¶", items: ["è­·ç…§ (æ•ˆæœŸå…§)", "æ©Ÿç¥¨æ†‘è­‰", "é£¯åº—é ç´„å–®", "æ–°å¹¹ç·šæŒ‡å®šå¸­ç¥¨åˆ¸"] },
            { cat: "æ—¥å¸¸ç”¨å“", items: ["è¡Œå‹•é›»æº", "æ—¥æœ¬ç¶²å¡", "è·‘é‹/å£“ç¸®è¥ª", "é›¨å‚˜"] }
        ];

        // --- åŠŸèƒ½é‚è¼¯ ---
        function initApp() { renderDatePicker(); renderItinerary(); }

        function renderDatePicker() {
            const picker = document.getElementById('date-picker-container');
            picker.innerHTML = '';
            for (let i = 0; i < 7; i++) {
                const date = new Date('2026-03-04');
                date.setDate(date.getDate() + i);
                const dayNum = i + 1;
                const div = document.createElement('div');
                div.className = `date-item flex flex-col items-center cursor-pointer px-2 ${dayNum === currentDay && activeTab === 'itinerary' ? 'active-date' : ''}`;
                div.onclick = () => { activeTab = 'itinerary'; currentDay = dayNum; toggleView('itinerary'); };
                div.innerHTML = `<span class="text-[8px] font-bold text-gray-400 uppercase">MAR</span><span class="text-[9px] font-bold">${daysOfWeek[date.getDay()]}</span><span class="text-xl date-num font-serif leading-none">${date.getDate()}</span><div class="date-dot"></div>`;
                picker.appendChild(div);
            }
        }

        function renderItinerary() {
            const container = document.getElementById('content');
            container.innerHTML = '';
            let html = '<div class="timeline-wrapper"><div class="timeline-line"></div>';
            tripData[currentDay].forEach(item => {
                html += `
                <div class="relative mb-8 pl-10">
                    <div class="timeline-dot"></div>
                    <div class="flex items-baseline mb-2">
                        <span class="text-xl font-serif font-bold text-gray-800 mr-3">${item.time}</span>
                        <div class="h-[1px] flex-1 bg-blue-100"></div>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-blue-50 active:scale-95 transition-all" onclick="showModal('${encodeURIComponent(JSON.stringify(item))}')">
                        <div class="flex items-center justify-between mb-1.5">
                            <div class="flex items-center">
                                <i class="fas ${item.icon} mr-2 text-blue-400 text-xs"></i>
                                <span class="text-[9px] font-bold text-blue-400 uppercase tracking-widest">${item.tag}</span>
                            </div>
                            ${item.tag === 'WBC' ? '<span class="wbc-tag">MATCH</span>' : ''}
                        </div>
                        <h3 class="text-base font-bold text-gray-800 leading-tight">${item.title}</h3>
                        <p class="text-[11px] text-gray-400 mt-2 line-clamp-1 leading-relaxed">${item.desc}</p>
                    </div>
                </div>`;
            });
            container.innerHTML = html + '</div><div id="map-container"></div>';
            renderDailyMap();
        }

        function renderDailyMap() {
            if (map) map.remove();
            map = L.map('map-container', { zoomControl: false });
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);
            const markers = [];
            tripData[currentDay].forEach((p) => { if (p.lat && p.lng) { L.marker([p.lat, p.lng]).addTo(map); markers.push([p.lat, p.lng]); } });
            if (markers.length > 0) map.fitBounds(L.polyline(markers).getBounds(), { padding: [40, 40] });
        }

        function toggleView(view) {
            activeTab = view;
            const lt = document.getElementById('ledger-toggle');
            const ct = document.getElementById('checklist-toggle');
            lt.className = `flex flex-col items-center ${activeTab === 'ledger' ? 'nav-btn-active' : 'text-gray-300'}`;
            ct.className = `flex flex-col items-center ${activeTab === 'checklist' ? 'nav-btn-active' : 'text-gray-300'}`;
            
            const container = document.getElementById('content');
            if (view === 'ledger') renderLedger();
            else if (view === 'checklist') renderChecklist();
            else renderItinerary();
            renderDatePicker();
        }

        function renderChecklist() {
            let html = '<div class="space-y-6">';
            packingList.forEach(group => {
                html += `<div class="bg-white p-5 rounded-2xl shadow-sm border border-blue-100"><h3 class="text-sm font-bold text-blue-500 mb-4 uppercase tracking-wider">${group.cat}</h3><div class="space-y-3">`;
                group.items.forEach(item => {
                    html += `<label class="flex items-center justify-between p-3 bg-gray-50 rounded-xl"><span class="text-sm font-medium text-gray-700">${item}</span><input type="checkbox" class="w-5 h-5 accent-blue-500"></label>`;
                });
                html += '</div></div>';
            });
            document.getElementById('content').innerHTML = html + '</div>';
        }

        function renderLedger() {
            document.getElementById('content').innerHTML = `
            <div class="bg-white p-6 rounded-3xl border border-blue-50 shadow-sm space-y-4">
                <h3 class="text-base font-bold text-gray-800 mb-4"><i class="fas fa-plus-circle mr-2 text-blue-400"></i> æ–°å¢æ”¯å‡º</h3>
                <div class="ledger-row"><span class="ledger-row-label row-blue">é‡‘é¡</span><input type="number" placeholder="0" class="ledger-row-input"></div>
                <div class="ledger-row"><span class="ledger-row-label row-gray">é …ç›®</span><input type="text" placeholder="ä¾‹å¦‚ï¼šæ–°å¹¹ç·šç¥¨" class="ledger-row-input"></div>
                <button class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold shadow-lg mt-4">å„²å­˜ç´€éŒ„</button>
            </div>`;
        }

        function showModal(itemStr) {
            const item = JSON.parse(decodeURIComponent(itemStr));
            const modal = document.getElementById('detail-modal');
            document.getElementById('modal-img').src = item.img;
            document.getElementById('modal-tag').textContent = item.tag;
            document.getElementById('modal-title').textContent = item.title;
            document.getElementById('modal-desc').textContent = item.desc;
            document.getElementById('modal-hours-text').textContent = item.hours || 'ä¾è¡Œç¨‹æ™‚é–“ç‚ºæº–';
            
            const tc = document.getElementById('modal-transport-container');
            if (item.transport) {
                document.getElementById('modal-transport').textContent = item.transport;
                tc.classList.remove('hidden');
            } else tc.classList.add('hidden');
            
            document.getElementById('modal-google-link').href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.map)}`;
            
            modal.classList.remove('hidden');
            setTimeout(() => { modal.classList.remove('opacity-0'); modal.querySelector('div').classList.remove('translate-y-full'); }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('detail-modal');
            modal.classList.add('opacity-0');
            modal.querySelector('div').classList.add('translate-y-full');
            setTimeout(() => { modal.classList.add('hidden'); }, 300);
        }

        window.onload = initApp;
    </script>
</body>
</html>
